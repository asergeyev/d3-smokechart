!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports,require("d3-scale"),require("d3-shape")):"function"==typeof define&&define.amd?define(["exports","d3-scale","d3-shape"],a):a((e=e||self).d3=e.d3||{},e.d3,e.d3)}(this,(function(e,a,t){"use strict";const r=(e,a)=>{if(a<0||a>1||isNaN(a))throw new Error(`Unable to calculate ${a} quantile`);var t=(e.length-1)*a,r=Math.floor(t),l=t-r;return l<.001?e[r]:Math.floor(e[r]*(1-l)+e[r+1]*l+.5)},l=[[],[[0,1]],[[0,1],[.25,.75]],[[0,1],[.15,.85],[.3,.7]],[[0,1],[.1,.9],[.2,.8],[.3,.7]],[[0,1],[.1,.9],[.2,.8],[.3,.7],[.4,.6]]],s=(e,a)=>l[a].map(([a,t])=>[r(e,a),r(e,t)]);e.Smokechart=(e,l)=>{const n={scaleX:a.scaleLinear(),scaleY:a.scaleLinear()};let c=[],o=Math.floor(1e5*Math.random());const d=(e,a)=>(e&&!Array.isArray(e)&&(a=e,e=void 0),a&&Object.assign(n,a),e&&d.data(e),o=Math.floor(1e5*Math.random()),d);return d.data=e=>e?(c=e.map(e=>[...e.filter(e=>!isNaN(e))].sort((e,a)=>e-a)),d):c,d.adjustScaleRange=()=>{if(n.scaleX&&n.scaleX.domain([0,c.length]),!n.scaleY)return;let e=1/0,a=-1/0;return c.forEach(t=>{t.length&&(t[0]<e&&(e=t[0]),t[t.length-1]>a&&(a=t[t.length-1]))}),n.scaleY.domain([e,a]),d},d.scaleX=e=>e?(n.scaleX=e,d):n.scaleX,d.scaleY=e=>e?(n.scaleY=e,d):n.scaleY,d.line=(e=.5)=>[t.line().x(e=>n.scaleX?n.scaleX(e[0]):e[0]).y(e=>n.scaleY?n.scaleY(e[1]):e[1])(c.reduce((a,t,l)=>{const s=r(t,e);return[...a,[l-.5,s],[l+.5,s]]},[]))],d.smokeBands=(e=2)=>{const a=t.line().x(e=>n.scaleX?n.scaleX(e[0]):e[0]).y(e=>n.scaleY?n.scaleY(e[1]):e[1]),r=c.reduce((t,r,l)=>{const n=s(r,e),c=l-.5;return[...t,n.map(([e,t])=>a([[c,e],[c,t],[c+1,t],[c+1,e]])||"")]},[]);return r[0].map((e,a)=>r.map(e=>e[a]).join(""))},d.countErrors=(e=-1)=>{const a=c.map(e=>e.length),t=e>=0?e:Math.max(...a);return a.map(e=>t>e?t-e:0).reduce((e,a,t)=>{if(a>0){const r=[],l=n.scaleX?n.scaleX(t):t;for(let e=0;e<a;e++)r.push({x:l,errPos:e});return[...e,...r]}return e},[])},d.chart=(e,a)=>{if((null==a?void 0:a.bands)&&e.selectAll("path.smokechart-band"+o).data(d.smokeBands(null==a?void 0:a.bands)).enter().append("path").classed("smokechart-band",!0).attr("fill","rgba(0,0,0,0.18)").attr("d",e=>e),e.selectAll("path.smokechart-line"+o).data(d.line(.5)).enter().append("path").classed("smokechart-line",!0).attr("stroke","#ff0000").attr("stroke-width",1.1).attr("fill","transparent").attr("d",e=>e),null==a?void 0:a.errors){const a=d.countErrors()||[];if(a.length){let t=n.scaleX(.25)-n.scaleX(0);t<2&&(t=2),e.selectAll("circle.smokechart-baseline"+o).data(a).enter().append("circle").attr("cx",e=>e.x).attr("cy",e=>t+e.errPos*t*2.2).attr("r",t).attr("fill","#f30")}}},d(e,l)},e.calculateSmokeBands=s,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=d3-smokechart.min.js.map
